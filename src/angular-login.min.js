"use strict";angular.module("angular-login-fbLoginConstants",[]).constant("LoginStatus",{OK:0,NotAuthorized:-1,NotLoggedIn:-2,Unknown:-3,Unexpected:-4});var fbLoginDirectives=angular.module("angular-login-fbLoginDirectives",[]);fbLoginDirectives.directive("fbLoginWelcomeUser",[function(){return{restrict:"E",template:"<div ng-show='auth.isLoggedIn()'><div><img ng-src='{{auth.getPicture()}}'><span>{{auth.getUsername()}}</span></div> (<a href='javascript:void(0)' ng-click='auth.logOut()'>Logout</a>)</div>"}}]);var fbLoginMain=angular.module("angular-login-fbLoginMain",["angular-login-fbLoginConstants","angular-login-fbLoginServices","angular-login-fbLoginDirectives"]),fbLoginServices=angular.module("angular-login-fbLoginServices",["angular-login-loginServices","angular-login-fbLoginConstants"]);fbLoginServices.service("fbLoginConfig",["loginConfig",function(a){this.configuration={appId:"appId",channelUrl:"app/channel.html"},this.setConfiguration=function(b){this.configuration.appId=b.appId||"",this.configuration.channelUrl=b.channelUrl||"",a.setConfiguration(b)},this.getConfiguration=function(){return angular.merge({},this.configuration,a.getConfiguration())}}]),fbLoginServices.service("fbLoginAuth",["loginAuth",function(a){this.isLoggedIn=function(){return a.isLoggedIn()},this.loggedIn=function(b){a.loggedIn(b)},this.logOut=function(){a.loggedOut()},this.getUsername=function(){return a.getUsername()},this.getPicture=function(){return a.getClaimValue("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/uri")},this.hasClaim=function(b,c){return a.hasClaim(b,c)}}]),fbLoginServices.service("fbLoginEventHandler",["fbLoginAuth","fbLoginConfig","loginToken","LoginStatus","$q",function(a,b,c,d,e){this.init=function(){function f(b){function e(b){c.retrieveToken(b.userID,b.accessToken).then(function(b){a.loggedIn(b)}).then(function(){h.resolve(d.OK)})["catch"](function(a){a.code&&"AUTH_001"===a.code?h.reject(d.Unknown):h.reject(d.Unexpected)})}a.isLoggedIn()?h.resolve(d.OK):e(b)}function g(a){"connected"===a.status&&a.authResponse?f(a.authResponse):"not_authorized"===a.status?h.reject(d.NotAuthorized):FB.Event.subscribe("auth.statusChange",function(a){g(a)})}var h=e.defer();return FB.init({appId:b.appId,channelUrl:b.channelUrl,status:!0,cookie:!0,xfbml:!0}),FB.getLoginStatus(function(a){g(a)}),h.promise}}]);var loginControllers=angular.module("angular-login-loginControllers",["angular-login-loginServices"]);loginControllers.controller("loginSignoutCtrl",["$scope","loginAuth","$location","loginConfig",function(a,b,c,d){a.logout=function(){b.loggedOut(),c.path(d.getConfiguration().pathToLogin)}}]),loginControllers.controller("loginSigninCtrl",["$scope","loginAuth","loginToken","loginRedirectToAttemptUrl",function(a,b,c,d){a.error="",a.credentials={username:"",pass:""},a.login=function(){var e=function(b){a.error=b};c.retrieveToken(a.credentials.username,a.credentials.pass).then(function(a){b.loggedIn(a)}).then(function(){e("")}).then(function(){d.redirect()})["catch"](function(){e("Username/password combination provided is incorrect")})}}]);var loginDirectives=angular.module("angular-login-loginDirectives",[]);loginDirectives.directive("loginwelcomeUser",[function(){return{restrict:"E",template:"<div ng-show='auth.isLoggedIn()'><p ng-controller='loginSignoutCtrl'>Hello {{auth.getUsername()}} (<a href='javascript:void(0)' ng-click='logout()'>Logout</a>)</p></div>"}}]);var loginMain=angular.module("angular-login-loginMain",["angular-login-loginControllers","angular-login-loginServices","angular-login-loginDirectives"]),loginServices=angular.module("angular-login-loginServices",["ngStorage","angular-jwt"]);loginServices.service("loginConfig",[function(){this.configuration={tokenApiUrlEndPoint:"http://localhost:8080/api/token",pathToLogin:"/login"},this.setConfiguration=function(a){this.configuration.tokenApiUrlEndPoint=a.tokenApiUrlEndPoint||"",this.configuration.pathToLogin=a.pathToLogin||""},this.getConfiguration=function(){return this.configuration}}]),loginServices.service("loginStorage",["$sessionStorage",function(a){this.getToken=function(){return a.token||""},this.setToken=function(b){a.token=b},this.removeToken=function(){a.token&&delete a.token}}]),loginServices.service("loginToken",["$http","$q","loginConfig",function(a,b,c){this.retrieveToken=function(d,e){var f=b.defer();return a.post(c.getConfiguration().tokenApiUrlEndPoint,{userIdentifier:d,secret:e}).then(function(a){f.resolve(a.data.token)})["catch"](function(a){f.reject(a.data)}),f.promise}}]),loginServices.service("loginRedirectToAttemptUrl",["$location","loginConfig",function(a,b){this.redirectToUrlAfterLogin={url:"/"},this.redirect=function(){a.path(this.redirectToUrlAfterLogin.url)},this.saveUrl=function(){b.getConfiguration().pathToLogin.toLowerCase()!=a.path().toLowerCase()&&(this.redirectToUrlAfterLogin.url=a.path())}}]),loginServices.service("loginAuth",["loginStorage","jwtHelper",function(a,b){this.isLoggedIn=function(){return!!a.getToken()},this.loggedIn=function(b){a.setToken(b)},this.loggedOut=function(){a.removeToken()},this.getUsername=function(){if(this.isLoggedIn())return b.decodeToken(a.getToken()).unique_name},this.getClaimValue=function(c){if(!this.isLoggedIn())return{};var d=b.decodeToken(a.getToken());return d[c]||{}},this.hasClaim=function(a,b){var c=this.getClaimValue(a);return Array.isArray(c)?c.indexOf(b)>=0:c===b}}]),loginServices.service("loginRequestInterceptor",["loginStorage","$q","$location","loginConfig","loginRedirectToAttemptUrl",function(a,b,c,d,e){this.request=function(b){var c=a.getToken();return b.headers=b.headers||{},c&&(b.headers.Authorization=c),b},this.responseError=function(a){return 401==a.status&&(e.saveUrl(),c.path(d.getConfiguration().pathToLogin)),b.reject(a)}}]);